name: Auto Merge PR

on:
  workflow_dispatch:
    inputs:
      pr_title:
        description: 'Pull Request title (partial or full)'
        required: true
        type: string

jobs:
  merge-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Merge PR by title
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const prTitle = core.getInput('pr_title');
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            const { data: pulls } = await github.rest.pulls.list({
              owner,
              repo,
              state: 'open',
            });

            const pr = pulls.find(p => p.title.toLowerCase().includes(prTitle.toLowerCase()));

            if (!pr) {
              core.setFailed(`No open PR found matching title: ${prTitle}`);
              return;
            }

            const prNumber = pr.number;

            await github.rest.pulls.merge({
              owner,
              repo,
              pull_number: prNumber,
              merge_method: 'merge',
            });

            core.info(`PR #${prNumber} titled "${pr.title}" merged successfully.`);
